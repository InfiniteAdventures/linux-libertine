% LaTeX-Package for libertine
%
% $Id$
%
% Michael Niedermair m.g.n@gmx.de
%
% (License GPL)
%
\def\libertineVersion{4.6.2}%
\def\libertineVersionDate{2009/11/08}
%
\ProvidesPackage{libertinenew}[%
   \libertineVersionDate\space-\space\libertineVersion:
   Font libertine - (License GPL) Michael Niedermair]

\newif\iffxl@otf
\fxl@otftrue
% load the other fonts ?
\newif\iffxl@nofl
\fxl@noflfalse

\RequirePackage{keyval,ifxetex}

\def\fxl@scale{1}%      scale factor
\def\fxl@default{0}%    nf, osf, ss, osfss

\define@key{fxl}{scaled}[1]{\def\fxl@scale{#1}}
\define@key{fxl}{default}[0]{\def\fxl@default{0}}
\define@key{fxl}{osf}[true]{\def\fxl@default{1}}
\define@key{fxl}{ss}[true]{\def\fxl@default{2}}
\define@key{fxl}{osfss}[true]{\def\fxl@default{3}}
\define@key{fxl}{nf}[true]{\def\fxl@default{0}}
\define@key{fxl}{nootf}[false]{\@nameuse{fxl@otf#1}}
\define@key{fxl}{nofl}[true]{\@nameuse{fxl@nofl#1}}

\def\ProcessOptionsWithKV#1{%
  \let\@tempc\relax
  \let\fxl@tempa\@empty
  \@for\CurrentOption:=\@classoptionslist\do{%
    \@ifundefined{KV@#1@\CurrentOption}%
    {}%
    {%
      \edef\fxl@tempa{\fxl@tempa,\CurrentOption,}%
      \@expandtwoargs\@removeelement\CurrentOption
        \@unusedoptionlist\@unusedoptionlist
    }%
  }%
  \edef\fxl@tempa{%
    \noexpand\setkeys{#1}{%
      \fxl@tempa\@ptionlist{\@currname.\@currext}%
    }%
  }%
  \fxl@tempa
  \let\CurrentOption\@empty
}
\ProcessOptionsWithKV{fxl}
\AtEndOfPackage{%
  \let\@unprocessedoptions\relax
}

\iffxl@otf
  \ifxetex
    \fxl@otftrue
  \else
    \fxl@otffalse
  \fi
\fi%

\def\libertine@param{}
\def\biolinum@param{}
%
\iffxl@otf
% xetex

\RequirePackage{xltxtra}
%
% #1 slant=0.2
% #2 m, b,
% #3 fontname
\newcommand\generateslanted[3][]{%
  \DeclareFontShape{EU1}{\zf@family}{#2}{sl}%
    {<->"#3:\ifcsname zf@pre@ff\endcsname\zf@pre@ff\fi\csname zf@ff\endcsname,#1"}%
    {}%
}
% \generateslanted     % only directly after \newfontfamily or \setmainfont or whatever
%   []        % N.B. 'raw' XeTeX font features!
%   {m}
%   {Linux Biolinum Slanted O} % whatever slanted font you want
%
%
% Font
\def\libertine@param{Mapping=tex-text,RawFeature=+liga}
\def\biolinum@param{Mapping=tex-text,RawFeature=+liga}
\ifcase\fxl@default% nf
  \def\libertine@param{Mapping=tex-text,RawFeature=+liga}
  \def\biolinum@param{Mapping=tex-text,RawFeature=+liga}
\or% osf
  \def\libertine@param{Mapping=tex-text,RawFeature=+liga;+onum}
  \def\biolinum@param{Mapping=tex-text,RawFeature=+liga;+onum}
\or% ss
  \def\libertine@param{Mapping=tex-text,RawFeature=+liga;+ss03}
  \def\biolinum@param{Mapping=tex-text,RawFeature=+liga;+ss03}
\or% osfss
  \def\libertine@param{Mapping=tex-text,RawFeature=+liga;+onum;+ss03}
  \def\biolinum@param{Mapping=tex-text,RawFeature=+liga;+onum;+ss03}
\fi
\setromanfont[\libertine@param]{Linux Libertine O}
\setsansfont[\biolinum@param]{Linux Biolinum O}
\newfontfamily\biolinum[\libertine@param]{Linux Biolinum O}
\iffxl@nofl\else
  \generateslanted{m}{Linux Biolinum Slanted O}%
\fi
\newfontfamily\libertine[\biolinum@param]{Linux Libertine O}
\iffxl@nofl\else
  \generateslanted{m}{Linux Libertine Slanted O}%
\fi
\iffxl@nofl\else
  \newfontfamily\biolinumB[\biolinum@param]{Linux Biolinum O Bold}
  \generateslanted{\bfdefault}{Linux Biolinum Slanted O Bold}%
  \newfontfamily\libertineB[\libertine@param]{Linux Libertine O Bold}
  \generateslanted{\bfdefault}{Linux Libertine Slanted O Bold}%
\fi
%
\ProvideTextCommand{\glqq}{EU1}{\textormath{\quotedblbase}{\mbox{\quotedblbase}}}
\ProvideTextCommand{\grqq}{EU1}{\textormath{\textquotedblleft}{\mbox{\textquotedblleft}}}
%
\DeclareRobustCommand*\libertineGlyph[1]{{%
   \libertine%
   \@tempcnta=\XeTeXglyphindex "#1"\relax%
   \ifnum\@tempcnta>0%
      \XeTeXglyph\@tempcnta%
   \fi
}}
\DeclareRobustCommand*\biolinumGlyph[1]{{%
   \biolinum%
   \@tempcnta=\XeTeXglyphindex "#1"\relax%
   \ifnum\@tempcnta>0%
      \XeTeXglyph\@tempcnta%
   \fi
}}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%55
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%55
\else
% latex
%
\def\libertine@param{}
\def\biolinum@param{}
% ------------------------------------------------
% default
\ifcase\fxl@default% nf
  \def\libertine@param{fxl}
  \def\biolinum@param{fxb}
\or% osf
  \def\libertine@param{fxlj}
  \def\biolinum@param{fxbj}
\or% ss
  \def\libertine@param{fxlo}
  \def\biolinum@param{fxbo}
\or% osfss
  \def\libertine@param{fxljo}
  \def\biolinum@param{fxbjo}
\fi
\renewcommand\rmdefault{\libertine@param}%
\renewcommand\sfdefault{\biolinum@param}%
%
% ---------------------------------------------------------
\newcommand*\DeclareTextGlyphX[5]{%
	% \DeclareTextGlyphX{fxl}{U}{fxla7}{uniA7F1}{241}
	% #1=basefont #2=encoding #3=fontfamily #4=glyphname, #5=position
   \@namedef{#1@#4}{\fontfamily{#3}\fontencoding{#2}\selectfont\char#5}}
\DeclareRobustCommand*\libertineGlyph[1]{\@nameuse{fxl@#1}}
\DeclareRobustCommand*\biolinumGlyph[1]{\@nameuse{fxb@#1}}
%
\input{fxl.inc}
\input{fxb.inc}
%
\def\libertine{\fontfamily{\libertine@param}\selectfont}
\def\biolinum{\fontfamily{\biolinum@param}\selectfont}
\iffxl@nofl\else
  \def\biolinumB{\fontfamily{\biolinum@param}\fontseries{b}\selectfont}
  \def\libertineB{\fontfamily{\libertine@param}\fontseries{b}\selectfont}
\fi
%
%
\fi
%
\DeclareTextCommandDefault{\texteuro}{{\libertineGlyph{Euro}}}
%
\endinput
